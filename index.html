<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é€å¥éŒ„éŸ³é…éŸ³ï¼ˆè€å¸«æ¨¡å¼ï¼‹ç¤ºç¯„è†è½ï¼‰</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", sans-serif; margin: 20px; }
    h2 { margin: 0 0 10px; }
    video { width: min(920px, 100%); background:#000; border-radius: 12px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin: 12px 0; }
    button { padding: 9px 12px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    .pill { padding: 4px 10px; border-radius: 999px; background:#f2f2f2; display:inline-block; }
    .hint { color:#555; line-height:1.6; margin-top: 6px; }

    .script { width: min(920px, 100%); }
    .line {
      border: 1px solid #e3e3e3;
      padding: 12px;
      margin: 10px 0;
      border-radius: 12px;
      display: grid;
      gap: 8px;
    }
    .lineHeader { display:flex; justify-content:space-between; gap: 10px; align-items:flex-start; }
    .role { font-weight: 800; font-size: 18px; }
    .time { color:#666; font-size: 13px; white-space: nowrap; }
    .text { font-size: 18px; line-height: 1.5; }
    .controls { display:flex; flex-wrap:wrap; gap: 8px; }
    .badge { font-size: 12px; padding: 3px 8px; border-radius: 999px; background: #f6f6f6; color:#555; }

    .active { background: #fff7d6; border-color: #f2d28a; }
    .done { background: #eafff6; border-color: #86e3c4; }
    .skip { opacity: .75; background:#fafafa; }
    .warn { color: #a33; }
    audio { width: min(920px, 100%); }
    textarea { width: min(920px, 100%); height: 140px; }
  </style>
</head>
<body>
  <h2>é€å¥éŒ„éŸ³é…éŸ³ï¼ˆè€å¸«æ¨¡å¼ï¼šä¸€éµè¨­æ™‚é–“ï¼‹ç¤ºç¯„è†è½ï¼‰</h2>

  <video id="video" src="video.mp4" controls playsinline preload="metadata"></video>

  <div class="row">
    <button id="btnInit">1) å…è¨±éº¥å…‹é¢¨</button>
    <button id="btnReplayAll" disabled>â–¶ å›æ”¾æˆå“ï¼ˆå½±ç‰‡+é€å¥éŒ„éŸ³ï¼‰</button>
    <button id="btnClear" disabled>ğŸ—‘ æ¸…é™¤å…¨éƒ¨éŒ„éŸ³</button>
    <button id="btnCopyTimes">ğŸ“‹ è¤‡è£½æ™‚é–“è¡¨ï¼ˆstart/endï¼‰</button>
    <span id="status" class="pill">å°šæœªåˆå§‹åŒ–</span>
  </div>

  <div class="row">
    <label><input type="checkbox" id="chkHearVideo" checked> éŒ„éŸ³æ™‚æ’­æ”¾å½±ç‰‡åŸéŸ³ï¼ˆåšæç¤ºï¼‰</label>
    <label><input type="checkbox" id="chkAutoNext" checked> æ¯å¥éŒ„å®Œè‡ªå‹•è·³ä¸‹ä¸€å¥</label>
    <label><input type="checkbox" id="chkDemoSeek" checked> æŒ‰ã€Œè½ç¤ºç¯„ã€è‡ªå‹•è·³åˆ°è©²å¥ç•«é¢ä¸¦æš«åœ</label>
  </div>

  <p class="hint">
    âœ… ç¤ºç¯„æª”æ”¾åœ¨ <span class="pill">sample/</span> è³‡æ–™å¤¾ï¼Œä¾‹å¦‚ç¬¬ 1 å¥ï¼š<span class="pill">sample/sample01.mp3</span><br>
    âœ… è€å¸«ä¿®ç§’æ•¸ï¼šæ’­åˆ°ä½ç½® â†’ æŒ‰è©²å¥ã€ŒğŸ“è¨­é–‹å§‹ / ğŸ“è¨­çµæŸã€<br>
    âœ… æŒ‰ã€ŒğŸ”Š è½ç¤ºç¯„ã€ï¼šæœƒæ’­æ”¾ç¤ºç¯„ï¼›æ’­å®Œæœƒè‡ªå‹•æŠŠç„¦é»ç§»åˆ°ã€ŒğŸ¤ éŒ„é€™ä¸€å¥ã€æ–¹ä¾¿å­¸ç”Ÿæ¥è‘—éŒ„
  </p>

  <p id="compat" class="hint warn" style="display:none;"></p>

  <div id="script" class="script"></div>

  <h3>ç¤ºç¯„è†è½</h3>
  <audio id="demoPlayer" controls></audio>

  <h3>å–®å¥é‡è½ï¼ˆå­¸ç”ŸéŒ„éŸ³ï¼‰</h3>
  <audio id="preview" controls></audio>

  <h3>æ™‚é–“è¡¨è¼¸å‡ºï¼ˆè¤‡è£½ç”¨ï¼‰</h3>
  <textarea id="timesOut" readonly placeholder="æŒ‰ã€Œè¤‡è£½æ™‚é–“è¡¨ã€å¾Œæœƒå‡ºç¾åœ¨é€™è£¡"></textarea>

<script>
(() => {
  const video = document.getElementById('video');
  const btnInit = document.getElementById('btnInit');
  const btnReplayAll = document.getElementById('btnReplayAll');
  const btnClear = document.getElementById('btnClear');
  const btnCopyTimes = document.getElementById('btnCopyTimes');
  const statusEl = document.getElementById('status');
  const scriptEl = document.getElementById('script');
  const compat = document.getElementById('compat');
  const preview = document.getElementById('preview');
  const demoPlayer = document.getElementById('demoPlayer');
  const timesOut = document.getElementById('timesOut');

  const chkHearVideo = document.getElementById('chkHearVideo');
  const chkAutoNext = document.getElementById('chkAutoNext');
  const chkDemoSeek = document.getElementById('chkDemoSeek');

  // âœ… å…ˆç”¨é è¨­æ™‚é–“ï¼ˆä½ æœƒç”¨ã€Œè¨­é–‹å§‹/è¨­çµæŸã€å»ä¿®æ­£ï¼‰
  const lines = [
    { role:"é˜¿å¿—", text:"è½å¥½ï¼ä»Šå¹´é˜¿å¬¤çš„ç´…åŒ…ç‰¹åˆ¥å¤§åŒ…ï¼Œå’±çµ•å°è¢‚ä½¿æ¼æ°£ï¼", start: 0.0,  end: 6.0 },
    { role:"ç¾ç¾", text:"å“¼ï¼Œæˆ‘æ—©å°±æº–å‚™å¥½äº†ã€‚ã€Œé‡‘éŠ€è²¡å¯¶æ»¿åå…§ï¼Œå¥½é‹é€™é¦¬ç·Šè½ä¾†ã€ï¼", start: 6.0,  end: 12.0 },
    { role:"å¤§èƒ–", text:"å•Š...æˆ‘åªæƒ³è¦é£Ÿå¹´ç³•...è…¹è‚šå¥½é¤“...", start: 12.0, end: 18.0 },
    { role:"é˜¿å¿—", text:"è¢‚ä½¿é£Ÿï¼é€™é¦¬é–‹å§‹ç‰¹è¨“ï¼å¤§èƒ–ï¼Œæ›ä½ ï¼ä¸Šå²å®³å½¼å¥ï¼", start: 18.0, end: 25.0 },
    { role:"å¤§èƒ–", text:"å–”å¥½ï¼ç¥é˜¿å¬¤...èº«é«”å¥åº·...è¬äº‹å¦‚æ„...é£Ÿç™¾äºŒ...", start: 25.0, end: 32.0 },
    { role:"é˜¿å¿—", text:"å¤ªæ™®é€šå•¦ï¼æ„›é–£è¼ƒæœ‰åŠ›å’§ï¼", start: 32.0, end: 36.0 },
    { role:"é˜¿å¬¤", text:"ä¹–å­«ï½é˜¿å¬¤ä¾†ç™¼ç´…åŒ…å›‰ï½", start: 38.0, end: 44.0 },
    { role:"ä¸‰äºº", text:"é˜¿å¬¤ï¼", start: 44.0, end: 46.0 },
    { role:"å¤§èƒ–", text:"é˜¿å¬¤ï¼ç¥ä½ ...ç¥ä½ ...ã€Œèº«é«”ç¡¬æ¢†æ¢†ã€ï¼", start: 46.0, end: 52.0 },
    { role:"é˜¿å¬¤", text:"å–”ï½èº«é«”çœŸå‹‡å•¦å¼ï¼çœŸä¹–çœŸä¹–ï¼Œå¤§åŒ…çš„äºˆä½ ï¼", start: 52.0, end: 60.0 }
  ];

  let micStream = null;                 // å…¨ç«™å…±ç”¨ä¸€æ”¯éº¥å…‹é¢¨ stream
  let currentIndex = 0;
  const recordings = new Array(lines.length).fill(null); // Blob per line
  const recordingUrls = new Array(lines.length).fill(null);

  const setStatus = (t) => statusEl.textContent = t;

  const ensureCompatibility = () => {
    compat.style.display = 'none';
    if (!navigator.mediaDevices?.getUserMedia) {
      compat.textContent = 'æ­¤ç€è¦½å™¨ä¸æ”¯æ´ getUserMediaã€‚å»ºè­°ä½¿ç”¨ Chrome / Edge / Safari æ–°ç‰ˆã€‚';
      compat.style.display = 'block';
      return false;
    }
    if (!window.MediaRecorder) {
      compat.textContent = 'æ­¤ç€è¦½å™¨ä¸æ”¯æ´ MediaRecorderï¼ˆéŒ„éŸ³ï¼‰ã€‚å»ºè­°ä½¿ç”¨ Chrome / Edge / Safari 17+ã€‚';
      compat.style.display = 'block';
      return false;
    }
    return true;
  };

  const pickMime = () => {
    const candidates = [
      'audio/webm;codecs=opus',
      'audio/webm',
      'audio/ogg;codecs=opus',
      'audio/ogg'
    ];
    for (const m of candidates) {
      if (MediaRecorder.isTypeSupported?.(m)) return m;
    }
    return '';
  };

  const seekTo = (videoEl, t) => new Promise((resolve) => {
    const done = () => { videoEl.removeEventListener('seeked', done); resolve(); };
    videoEl.addEventListener('seeked', done);
    videoEl.currentTime = t;
  });

  const clamp = (x, a, b) => Math.max(a, Math.min(b, x));
  const nowTime = () => Number(video.currentTime.toFixed(2)); // è€å¸«æŠ“ç§’æ•¸ç”¨
  const formatTime = (t) => `${Number(t).toFixed(2)}s`;

  const pad2 = (n) => String(n).padStart(2, '0');
  const demoUrlForIndex = (i) => `sample/sample${pad2(i + 1)}.mp3`;

  const focusRecordButton = (i) => {
    const btn = document.querySelector(`#line-${i} button[data-act="record"][data-i="${i}"]`);
    if (btn) btn.focus();
  };

  const render = () => {
    scriptEl.innerHTML = '';
    lines.forEach((l, i) => {
      const div = document.createElement('div');
      div.className = 'line';
      div.id = `line-${i}`;

      if (l.skip) div.classList.add('skip');
      if (i === currentIndex) div.classList.add('active');
      if (recordings[i]) div.classList.add('done');

      div.innerHTML = `
        <div class="lineHeader">
          <div>
            <div class="role">${l.role} <span class="badge">ç¬¬ ${i+1} å¥</span> ${l.skip ? '<span class="badge">ä¸ç”¨éŒ„</span>' : ''}</div>
          </div>
          <div class="time">${formatTime(l.start)} â†’ ${formatTime(l.end)}</div>
        </div>
        <div class="text">${l.text}</div>

        <div class="controls">
          ${l.skip ? '' : `<button data-act="record" data-i="${i}" ${!micStream ? 'disabled' : ''}>ğŸ¤ éŒ„é€™ä¸€å¥</button>`}
          ${l.skip ? '' : `<button data-act="demo" data-i="${i}">ğŸ”Š è½ç¤ºç¯„</button>`}
          <button data-act="goto" data-i="${i}">â© è·³åˆ°é€™å¥ç•«é¢</button>
          <button data-act="play" data-i="${i}" ${recordings[i] ? '' : 'disabled'}>â–¶ é‡è½é€™å¥</button>
          <button data-act="clear" data-i="${i}" ${recordings[i] ? '' : 'disabled'}>ğŸ—‘ æ¸…é™¤é€™å¥</button>

          <span class="badge">è€å¸«æ¨¡å¼</span>
          <button data-act="setStart" data-i="${i}">ğŸ“è¨­é–‹å§‹</button>
          <button data-act="setEnd" data-i="${i}">ğŸ“è¨­çµæŸ</button>
        </div>
      `;
      scriptEl.appendChild(div);
    });

    btnReplayAll.disabled = !recordings.some(Boolean);
    btnClear.disabled = !recordings.some(Boolean);
  };

const setActive = (i, { scroll = true } = {}) => {
  currentIndex = clamp(i, 0, lines.length - 1);
  while (lines[currentIndex]?.skip && currentIndex < lines.length - 1) currentIndex++;
  render();

  if (scroll) {
    document.getElementById(`line-${currentIndex}`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
};


  const clearLine = (i) => {
    if (recordingUrls[i]) URL.revokeObjectURL(recordingUrls[i]);
    recordings[i] = null;
    recordingUrls[i] = null;
    if (preview.src) preview.src = '';
    render();
  };

  const playLine = (i) => {
    if (!recordings[i]) return;
    if (recordingUrls[i]) URL.revokeObjectURL(recordingUrls[i]);
    recordingUrls[i] = URL.createObjectURL(recordings[i]);
    preview.src = recordingUrls[i];
    preview.play().catch(()=>{});
  };

  // âœ… è€å¸«ä¸€éµè¨­ç§’æ•¸ï¼šè‡ªå‹•ä¿è­· end > start
  const setStart = (i) => {
    const t = nowTime();
    lines[i].start = t;
    if (lines[i].end <= lines[i].start) lines[i].end = Number((lines[i].start + 0.20).toFixed(2));
    setStatus(`ç¬¬ ${i+1} å¥ï¼šstart è¨­ç‚º ${formatTime(lines[i].start)}`);
    render();
  };

  const setEnd = (i) => {
    const t = nowTime();
    lines[i].end = t;
    if (lines[i].end <= lines[i].start) lines[i].start = Number((lines[i].end - 0.20).toFixed(2));
    if (lines[i].start < 0) lines[i].start = 0;
    setStatus(`ç¬¬ ${i+1} å¥ï¼šend è¨­ç‚º ${formatTime(lines[i].end)}`);
    render();
  };

  // âœ… æ’­æ”¾ç¤ºç¯„ï¼šå¯é¸æ“‡è‡ªå‹•è·³åˆ°è©²å¥ç•«é¢ä¸¦æš«åœï¼›æ’­å®Œèšç„¦åˆ°éŒ„éŸ³æŒ‰éˆ•
  const playDemo = async (i) => {
    const line = lines[i];
    if (line.skip) return;

    setActive(i, { scroll: false });


    // æ’­ç¤ºç¯„å‰ï¼šè·³åˆ°è©²å¥ç•«é¢ä¸¦æš«åœï¼ˆå¯é—œé–‰ï¼‰
    if (chkDemoSeek.checked) {
      video.pause();
      video.muted = true;
      await seekTo(video, line.start);
    }

    // åœæ­¢å­¸ç”ŸéŒ„éŸ³é è¦½ï¼ˆé¿å…å…©å€‹éŸ³æºåŒæ™‚å‡ºè²ï¼‰
    preview.pause();

    const url = demoUrlForIndex(i);
    demoPlayer.src = url;

    demoPlayer.onerror = () => {
      alert(`æ‰¾ä¸åˆ°ç¤ºç¯„æª”ï¼š${url}\nè«‹ç¢ºèª sample è³‡æ–™å¤¾å…§æ˜¯å¦æœ‰ sample${pad2(i + 1)}.mp3`);
    };

    setStatus(`æ’­æ”¾ç¤ºç¯„ï¼šç¬¬ ${i+1} å¥`);
    try {
      await demoPlayer.play();
    } catch {
      // è‹¥è¢«ç€è¦½å™¨æ“‹ï¼Œä½¿ç”¨è€…å†æŒ‰ä¸€æ¬¡å³å¯
    }

    demoPlayer.onended = () => {
      setStatus(`ç¤ºç¯„æ’­å®Œï¼šç¬¬ ${i+1} å¥ï¼ˆå¯é–‹å§‹éŒ„éŸ³ï¼‰`);
      focusRecordButton(i);
    };
  };

  const recordLine = async (i) => {
    const line = lines[i];
    if (line.skip) return;

    setActive(i);
    setStatus(`æº–å‚™ç¬¬ ${i+1} å¥â€¦`);

    // å…ˆåœæ­¢ç¤ºç¯„ï¼ˆé¿å…å…©å€‹éŸ³æºåŒæ™‚å‡ºè²ï¼‰
    demoPlayer.pause();
    demoPlayer.currentTime = 0;

    // 1) è·³åˆ°è©²å¥é–‹å§‹
    await seekTo(video, line.start);

    // 2) è¨­å®šéŒ„éŸ³å™¨
    const mimeType = pickMime();
    const recorder = new MediaRecorder(micStream, mimeType ? { mimeType } : undefined);
    const chunks = [];

    // 3) éŒ„éŸ³æ™‚å½±ç‰‡åŸéŸ³æ˜¯å¦æ’­æ”¾
    video.muted = !chkHearVideo.checked;

    // 4) ç›¯å½±ç‰‡æ™‚é–“ï¼Œåˆ° end è‡ªå‹•åœ
    const stopAtEnd = () => {
      video.pause();
      cleanup();
      if (recorder.state !== 'inactive') recorder.stop();
    };
    const onTime = () => {
      if (video.currentTime >= line.end) stopAtEnd();
    };
    const cleanup = () => {
      video.removeEventListener('timeupdate', onTime);
      video.removeEventListener('ended', stopAtEnd);
    };

    recorder.ondataavailable = (e) => { if (e.data.size) chunks.push(e.data); };

    recorder.onstop = () => {
      const blob = new Blob(chunks, { type: recorder.mimeType || 'audio/webm' });
      recordings[i] = blob;

      setStatus(`ç¬¬ ${i+1} å¥éŒ„å®Œ âœ…`);
      render();

      if (chkAutoNext.checked) setActive(i + 1);
    };

    // 5) é–‹å§‹æ’­æ”¾ + é–‹å§‹éŒ„éŸ³
    video.addEventListener('timeupdate', onTime);
    video.addEventListener('ended', stopAtEnd);

    recorder.start();
    setStatus(`éŒ„éŸ³ä¸­ï¼šç¬¬ ${i+1} å¥â€¦`);
    await video.play().catch(()=>{});
  };

const replayAll = async () => {
    setStatus('å›æ”¾ä¸­ï¼ˆiOS å„ªåŒ–æ¨¡å¼ï¼‰â€¦');
    demoPlayer.pause();
    
    // 1. æš«æ™‚ç§»é™¤æ§åˆ¶åˆ— (é—œéµï¼é˜²æ­¢ iPhone è·³å‡ºåŸç”Ÿæ’­æ”¾æš«åœé®ç½©)
    video.removeAttribute('controls');
    
    video.muted = true;
    video.currentTime = 0;
    
    // è®“ç•«é¢å¹³æ»‘æ²å‹•åˆ°å½±ç‰‡å€
    video.scrollIntoView({ behavior: 'smooth', block: 'center' });

    let nextIndex = 0;
    let currentAudio = null;

    const onTimeUpdate = () => {
      const t = video.currentTime;

      // --- A. æ’­æ”¾ä¸‹ä¸€å¥ ---
      if (nextIndex < lines.length && t >= lines[nextIndex].start) {
        
        // åˆ‡æ–·ä¸Šä¸€å¥è²éŸ³
        if (currentAudio) {
          currentAudio.pause();
          currentAudio = null;
        }

        const line = lines[nextIndex];

        if (!line.skip && recordings[nextIndex]) {
          setActive(nextIndex, { scroll: false });

          const url = URL.createObjectURL(recordings[nextIndex]);
          currentAudio = new Audio(url);
          
          // iOS æŠ€å·§ï¼šæœ‰æ™‚å€™å»ºç«‹ Audio éœ€è¦æ˜ç¢ºæŒ‡å®š playsInline æˆ–è¼‰å…¥
          currentAudio.play().catch((e) => {
            console.log('Audio autoplay blocked?', e);
          });
          
          currentAudio.onended = () => { currentAudio = null; };
        }
        nextIndex++;
      }

      // --- B. è¶…æ™‚æˆªæ–· ---
      const playingIndex = nextIndex - 1;
      if (playingIndex >= 0 && currentAudio) {
        const playingLine = lines[playingIndex];
        if (t >= playingLine.end) {
          currentAudio.pause();
          currentAudio = null;
        }
      }
    };

    const cleanup = () => {
      video.removeEventListener('timeupdate', onTimeUpdate);
      video.removeEventListener('ended', cleanup);
      
      // åœæ­¢è²éŸ³
      if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
      }
      
      // 2. å›æ”¾çµæŸå¾Œï¼ŒæŠŠæ§åˆ¶åˆ—åŠ å›å»ï¼Œè®“ä½¿ç”¨è€…å¯ä»¥è‡ªå·±æ‹‰é€²åº¦æ¢
      video.setAttribute('controls', '');
      
      if (video.ended) setStatus('å›æ”¾çµæŸ');
    };

    video.addEventListener('timeupdate', onTimeUpdate);
    video.addEventListener('ended', cleanup);

    try {
      await video.play();
    } catch (err) {
      alert('æ’­æ”¾å¤±æ•—ï¼ŒiOS éœ€è¦æ‚¨å…ˆé»æ“Šç•«é¢');
      // å¦‚æœå¤±æ•—ä¹Ÿè¦æŠŠ controls åŠ å›å»ï¼Œä¸ç„¶ä½¿ç”¨è€…æœƒå£æ‰
      video.setAttribute('controls', '');
    }
  };
  const clearAll = () => {
    for (let i=0;i<lines.length;i++) clearLine(i);
    setActive(0);
    setStatus('å·²æ¸…é™¤å…¨éƒ¨éŒ„éŸ³');
  };

  const copyTimes = async () => {
    const out = lines.map(l => ({
      role: l.role,
      text: l.text,
      ...(l.skip ? { skip: true } : {}),
      start: Number(l.start.toFixed(2)),
      end: Number(l.end.toFixed(2)),
    }));

    const pretty = JSON.stringify(out, null, 2);
    timesOut.value = pretty;

    try {
      await navigator.clipboard.writeText(pretty);
      setStatus('æ™‚é–“è¡¨å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ…');
    } catch {
      setStatus('æ™‚é–“è¡¨å·²ç”¢ç”Ÿï¼ˆå¯æ‰‹å‹•å…¨é¸è¤‡è£½ï¼‰');
    }
  };

  // äº‹ä»¶ï¼šæŒ‰éˆ•æ“ä½œ
  scriptEl.addEventListener('click', async (e) => {
    const btn = e.target.closest('button');
    if (!btn) return;
    const act = btn.dataset.act;
    const i = Number(btn.dataset.i);

    if (act === 'record') await recordLine(i);
    if (act === 'demo') await playDemo(i);
    if (act === 'goto') { setActive(i); await seekTo(video, lines[i].start); await video.play().catch(()=>{}); }
    if (act === 'play') { setActive(i); playLine(i); }
    if (act === 'clear') { setActive(i); clearLine(i); }
    if (act === 'setStart') { setActive(i); setStart(i); }
    if (act === 'setEnd') { setActive(i); setEnd(i); }
  });

  // åˆå§‹åŒ–éº¥å…‹é¢¨
  btnInit.addEventListener('click', async () => {
    if (!ensureCompatibility()) return;
    try {
      micStream = await navigator.mediaDevices.getUserMedia({
        audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true }
      });
      setStatus('éº¥å…‹é¢¨å·²å°±ç·’ âœ…ï¼ˆå¯é–‹å§‹é€å¥éŒ„éŸ³ / è€å¸«è¨­ç§’æ•¸ / è½ç¤ºç¯„ï¼‰');
      setActive(0);
      render();
    } catch (err) {
      alert('å–å¾—éº¥å…‹é¢¨å¤±æ•—ï¼š' + err.message);
      setStatus('éº¥å…‹é¢¨æ¬Šé™å¤±æ•—');
    }
  });

  btnReplayAll.addEventListener('click', replayAll);
  btnClear.addEventListener('click', clearAll);
  btnCopyTimes.addEventListener('click', copyTimes);

  // åˆæ¬¡æ¸²æŸ“
  setActive(0);
  render();
})();
</script>
</body>
</html>